<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>提取历史 - 链文</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        tertiary: '#06b6d4',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        info: '#3b82f6',
                        'text-primary': '#1f2937',
                        'text-secondary': '#6b7280',
                        'bg-primary': '#f8fafc',
                        'bg-secondary': '#f1f5f9',
                        'border-primary': '#e2e8f0',
                        'border-secondary': '#cbd5e1'
                    },
                    backgroundImage: {
                        'gradient-primary': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        'gradient-secondary': 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                        'gradient-tertiary': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                        'gradient-success': 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                        'gradient-card': 'linear-gradient(145deg, #ffffff 0%, #f8fafc 100%)',
                        'gradient-bg': 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)'
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 20px rgba(102, 126, 234, 0.3)',
                        'glow-hover': '0 0 30px rgba(102, 126, 234, 0.5)'
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-collapsed {
            width: 56px;
        }
        
        .sidebar-expanded {
            width: 240px;
        }
        
        .main-content-expanded {
            margin-left: 240px;
        }
        
        .main-content-collapsed {
            margin-left: 56px;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .input-focus:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-gradient:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            transform: translateY(-1px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .card-gradient {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.5);
        }
        
        .nav-item-active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-right: 3px solid #667eea;
        }
        
        .nav-item-hover:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
        }
        
        .table-row-hover:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.02) 0%, rgba(118, 75, 162, 0.02) 100%);
        }
        
        .status-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(56, 249, 215, 0.1) 100%);
            color: #10b981;
        }
        
        .status-failed {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(248, 113, 113, 0.1) 100%);
            color: #ef4444;
        }
        
        .platform-bilibili {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            color: #667eea;
        }
        
        .platform-youtube {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(248, 113, 113, 0.1) 100%);
            color: #ef4444;
        }
        
        .platform-douyin {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(56, 249, 215, 0.1) 100%);
            color: #10b981;
        }
        
        .pagination-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .pagination-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gradient-bg min-h-screen">
    <!-- 顶部导航栏 -->
    <header id="top-navbar" class="fixed top-0 left-0 right-0 h-16 bg-white/90 backdrop-blur-md border-b border-gray-200/50 z-50">
        <div class="flex items-center justify-between h-full px-4">
            <!-- 左侧：Logo和菜单切换 -->
            <div id="navbar-left" class="flex items-center space-x-4">
                <button id="sidebar-toggle" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                    <i class="fas fa-bars text-gray-600"></i>
                </button>
                <div id="logo-section" class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-primary rounded-lg flex items-center justify-center">
                        <i class="fas fa-link text-white text-sm"></i>
                    </div>
                    <h1 class="text-xl font-bold gradient-text">链文</h1>
                </div>
            </div>
            
            <!-- 中间：搜索框 -->
            <div id="navbar-center" class="hidden md:flex flex-1 max-w-md mx-8">
                <div class="relative w-full">
                    <input type="text" id="global-search" placeholder="搜索历史记录..." 
                           class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg input-focus">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>
            
            <!-- 右侧：用户操作 -->
            <div id="navbar-right" class="flex items-center space-x-4">
                <button id="notification-btn" class="p-2 rounded-lg hover:bg-gray-100 transition-colors relative">
                    <i class="fas fa-bell text-gray-600"></i>
                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-danger rounded-full"></span>
                </button>
                <div id="user-menu" class="flex items-center space-x-3">
                    <img src="https://s.coze.cn/image/v3epbvwUDdw/" 
                         alt="用户头像" class="w-8 h-8 rounded-full border-2 border-primary/20">
                    <span class="hidden md:block text-sm font-medium text-gray-700">张小明</span>
                    <button id="user-dropdown" class="p-1 rounded hover:bg-gray-100">
                        <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 左侧菜单 -->
    <aside id="sidebar" class="fixed left-0 top-16 bottom-0 sidebar-expanded bg-white/90 backdrop-blur-md border-r border-gray-200/50 z-40 transition-all duration-300">
        <nav id="sidebar-nav" class="p-4 space-y-2">
            <a href="P-HOME.html" id="nav-home" class="nav-item-hover flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:text-gray-800 transition-all">
                <i class="fas fa-home text-lg w-5"></i>
                <span class="sidebar-text">首页</span>
            </a>
            <a href="P-BATCH_PROCESS.html" id="nav-batch" class="nav-item-hover flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:text-gray-800 transition-all">
                <i class="fas fa-layer-group text-lg w-5"></i>
                <span class="sidebar-text">批量处理</span>
            </a>
            <a href="#" id="nav-history" class="nav-item-active flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 font-medium transition-all">
                <i class="fas fa-history text-lg w-5"></i>
                <span class="sidebar-text">历史记录</span>
            </a>
            <a href="P-HELP.html" id="nav-help" class="nav-item-hover flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-600 hover:text-gray-800 transition-all">
                <i class="fas fa-question-circle text-lg w-5"></i>
                <span class="sidebar-text">帮助教程</span>
            </a>
        </nav>
        
        <!-- 底部统计信息 -->
        <div id="sidebar-footer" class="absolute bottom-4 left-4 right-4">
            <div class="sidebar-text p-3 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg">
                <div class="text-xs text-gray-500 mb-1">总提取次数</div>
                <div class="text-lg font-bold gradient-text">156 次</div>
            </div>
        </div>
    </aside>

    <!-- 主内容区 -->
    <main id="main-content" class="main-content-expanded pt-16 min-h-screen transition-all duration-300">
        <div class="p-6 max-w-7xl mx-auto">
            <!-- 页面头部 -->
            <div id="page-header" class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-white mb-2">提取历史</h2>
                        <nav id="breadcrumb" class="text-white/80 text-sm">
                            <span>首页</span>
                            <i class="fas fa-chevron-right mx-2"></i>
                            <span>提取历史</span>
                        </nav>
                    </div>
                    <div class="text-right text-white/80">
                        <div class="text-sm">总记录数</div>
                        <div class="text-2xl font-bold text-white">156</div>
                    </div>
                </div>
            </div>

            <!-- 工具栏区域 -->
            <section id="toolbar-section" class="card-gradient p-6 rounded-2xl shadow-card mb-6">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                    <!-- 搜索和筛选 -->
                    <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 flex-1">
                        <div class="relative flex-1 max-w-md">
                            <input type="text" id="history-search" placeholder="搜索视频链接或平台..." 
                                   class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl input-focus">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                        
                        <div class="flex space-x-4">
                            <select id="platform-filter" class="px-4 py-3 border border-gray-300 rounded-xl input-focus">
                                <option value="">全部平台</option>
                                <option value="bilibili">Bilibili</option>
                                <option value="youtube">YouTube</option>
                                <option value="douyin">抖音</option>
                            </select>
                            
                            <select id="status-filter" class="px-4 py-3 border border-gray-300 rounded-xl input-focus">
                                <option value="">全部状态</option>
                                <option value="success">提取成功</option>
                                <option value="failed">提取失败</option>
                            </select>
                            
                            <select id="time-filter" class="px-4 py-3 border border-gray-300 rounded-xl input-focus">
                                <option value="">全部时间</option>
                                <option value="today">今天</option>
                                <option value="week">最近一周</option>
                                <option value="month">最近一月</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 批量操作 -->
                    <div class="flex space-x-3">
                        <button id="batch-delete-btn" class="px-6 py-3 bg-danger text-white rounded-xl hover:bg-red-600 transition-colors disabled:opacity-50" disabled>
                            <i class="fas fa-trash mr-2"></i>
                            批量删除
                        </button>
                        <button id="clear-all-btn" class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors">
                            <i class="fas fa-broom mr-2"></i>
                            清空历史
                        </button>
                    </div>
                </div>
            </section>

            <!-- 数据展示区域 -->
            <section id="data-section" class="card-gradient rounded-2xl shadow-card overflow-hidden">
                <!-- 表格头部 -->
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="select-all" class="rounded border-gray-300 text-primary focus:ring-primary">
                                <span class="ml-2 text-sm text-gray-700">全选</span>
                            </label>
                            <span class="text-sm text-gray-500">已选择 <span id="selected-count">0</span> 项</span>
                        </div>
                        <div class="text-sm text-gray-500">
                            共 <span id="total-count">156</span> 条记录
                        </div>
                    </div>
                </div>
                
                <!-- 表格内容 -->
                <div class="overflow-x-auto">
                    <table id="history-table" class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12">
                                    <input type="checkbox" id="header-checkbox" class="rounded border-gray-300 text-primary focus:ring-primary">
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:text-gray-700" data-sort="url">
                                    视频链接
                                    <i class="fas fa-sort ml-1"></i>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:text-gray-700" data-sort="platform">
                                    平台
                                    <i class="fas fa-sort ml-1"></i>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:text-gray-700" data-sort="time">
                                    提取时间
                                    <i class="fas fa-sort ml-1"></i>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:text-gray-700" data-sort="status">
                                    状态
                                    <i class="fas fa-sort ml-1"></i>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    操作
                                </th>
                            </tr>
                        </thead>
                        <tbody id="history-tbody" class="bg-white divide-y divide-gray-200">
                            <!-- 动态生成的表格行将在这里 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 分页区域 -->
                <div id="pagination-section" class="px-6 py-4 border-t border-gray-200 bg-gray-50">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-700">每页显示</span>
                            <select id="page-size" class="px-3 py-1 border border-gray-300 rounded text-sm input-focus">
                                <option value="10">10</option>
                                <option value="20" selected>20</option>
                                <option value="50">50</option>
                            </select>
                            <span class="text-sm text-gray-700">条记录</span>
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <button id="prev-page" class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-100 transition-colors pagination-disabled">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div id="page-numbers" class="flex space-x-1">
                                <!-- 动态生成的页码按钮将在这里 -->
                            </div>
                            <button id="next-page" class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-100 transition-colors">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        
                        <div class="text-sm text-gray-700">
                            显示第 <span id="start-record">1</span>-<span id="end-record">20</span> 条，共 <span id="total-records">156</span> 条
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- 删除确认模态框 -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-xl max-w-md w-full">
                <div class="p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-danger/10 rounded-xl flex items-center justify-center mr-4">
                            <i class="fas fa-exclamation-triangle text-danger text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">确认删除</h3>
                            <p class="text-sm text-gray-600">此操作不可撤销</p>
                        </div>
                    </div>
                    <p id="delete-message" class="text-gray-700 mb-6">您确定要删除选中的记录吗？</p>
                    <div class="flex space-x-3">
                        <button id="cancel-delete" class="flex-1 py-3 px-4 border border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 transition-colors">
                            取消
                        </button>
                        <button id="confirm-delete" class="flex-1 py-3 px-4 bg-danger text-white rounded-xl hover:bg-red-600 transition-colors">
                            删除
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 模拟历史记录数据
        const mockHistoryData = [
            {
                id: 'rec001',
                url: 'https://www.bilibili.com/video/BV1234567890',
                platform: 'bilibili',
                platformName: 'Bilibili',
                time: '2024-01-15 14:30:25',
                status: 'success'
            },
            {
                id: 'rec002',
                url: 'https://www.youtube.com/watch?v=abcdefghijk',
                platform: 'youtube',
                platformName: 'YouTube',
                time: '2024-01-15 13:45:12',
                status: 'success'
            },
            {
                id: 'rec003',
                url: 'https://v.douyin.com/abc123/',
                platform: 'douyin',
                platformName: '抖音',
                time: '2024-01-15 12:20:33',
                status: 'failed'
            },
            {
                id: 'rec004',
                url: 'https://www.bilibili.com/video/BV0987654321',
                platform: 'bilibili',
                platformName: 'Bilibili',
                time: '2024-01-15 11:15:44',
                status: 'success'
            },
            {
                id: 'rec005',
                url: 'https://www.youtube.com/watch?v=lmnopqrstuv',
                platform: 'youtube',
                platformName: 'YouTube',
                time: '2024-01-14 16:50:18',
                status: 'success'
            },
            {
                id: 'rec006',
                url: 'https://v.douyin.com/def456/',
                platform: 'douyin',
                platformName: '抖音',
                time: '2024-01-14 15:30:22',
                status: 'success'
            },
            {
                id: 'rec007',
                url: 'https://www.bilibili.com/video/BV1357924680',
                platform: 'bilibili',
                platformName: 'Bilibili',
                time: '2024-01-14 14:15:35',
                status: 'failed'
            },
            {
                id: 'rec008',
                url: 'https://www.youtube.com/watch?v=wxyz123456',
                platform: 'youtube',
                platformName: 'YouTube',
                time: '2024-01-14 13:00:47',
                status: 'success'
            }
        ];

        // 页面状态管理
        let currentPage = 1;
        let pageSize = 20;
        let sortField = 'time';
        let sortOrder = 'desc';
        let filteredData = [...mockHistoryData];
        let selectedRecords = new Set();

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeSidebar();
            initializeTable();
            initializeEventListeners();
            renderTable();
            updatePagination();
        });

        // 侧边栏初始化
        function initializeSidebar() {
            const sidebarToggle = document.querySelector('#sidebar-toggle');
            const sidebar = document.querySelector('#sidebar');
            const mainContent = document.querySelector('#main-content');
            const sidebarTexts = document.querySelectorAll('.sidebar-text');
            
            let sidebarCollapsed = false;
            
            sidebarToggle.addEventListener('click', () => {
                sidebarCollapsed = !sidebarCollapsed;
                
                if (sidebarCollapsed) {
                    sidebar.classList.remove('sidebar-expanded');
                    sidebar.classList.add('sidebar-collapsed');
                    mainContent.classList.remove('main-content-expanded');
                    mainContent.classList.add('main-content-collapsed');
                    sidebarTexts.forEach(text => text.style.display = 'none');
                } else {
                    sidebar.classList.remove('sidebar-collapsed');
                    sidebar.classList.add('sidebar-expanded');
                    mainContent.classList.remove('main-content-collapsed');
                    mainContent.classList.add('main-content-expanded');
                    sidebarTexts.forEach(text => text.style.display = 'block');
                }
            });
        }

        // 表格初始化
        function initializeTable() {
            // 全选功能
            const selectAllCheckbox = document.querySelector('#select-all');
            const headerCheckbox = document.querySelector('#header-checkbox');
            
            [selectAllCheckbox, headerCheckbox].forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const isChecked = this.checked;
                    const rowCheckboxes = document.querySelectorAll('tbody input[type="checkbox"]');
                    
                    rowCheckboxes.forEach(checkbox => {
                        checkbox.checked = isChecked;
                        if (isChecked) {
                            selectedRecords.add(checkbox.value);
                        } else {
                            selectedRecords.delete(checkbox.value);
                        }
                    });
                    
                    updateSelectedCount();
                    updateBatchDeleteButton();
                });
            });
        }

        // 事件监听器初始化
        function initializeEventListeners() {
            // 搜索功能
            const searchInput = document.querySelector('#history-search');
            searchInput.addEventListener('input', debounce(handleSearch, 300));
            
            // 筛选功能
            const platformFilter = document.querySelector('#platform-filter');
            const statusFilter = document.querySelector('#status-filter');
            const timeFilter = document.querySelector('#time-filter');
            
            [platformFilter, statusFilter, timeFilter].forEach(filter => {
                filter.addEventListener('change', handleFilter);
            });
            
            // 排序功能
            const sortHeaders = document.querySelectorAll('[data-sort]');
            sortHeaders.forEach(header => {
                header.addEventListener('click', handleSort);
            });
            
            // 批量删除
            const batchDeleteBtn = document.querySelector('#batch-delete-btn');
            batchDeleteBtn.addEventListener('click', () => showDeleteModal('batch'));
            
            // 清空历史
            const clearAllBtn = document.querySelector('#clear-all-btn');
            clearAllBtn.addEventListener('click', () => showDeleteModal('all'));
            
            // 分页
            const pageSizeSelect = document.querySelector('#page-size');
            const prevPageBtn = document.querySelector('#prev-page');
            const nextPageBtn = document.querySelector('#next-page');
            
            pageSizeSelect.addEventListener('change', handlePageSizeChange);
            prevPageBtn.addEventListener('click', () => changePage(currentPage - 1));
            nextPageBtn.addEventListener('click', () => changePage(currentPage + 1));
            
            // 删除模态框
            const cancelDeleteBtn = document.querySelector('#cancel-delete');
            const confirmDeleteBtn = document.querySelector('#confirm-delete');
            
            cancelDeleteBtn.addEventListener('click', hideDeleteModal);
            confirmDeleteBtn.addEventListener('click', handleConfirmDelete);
            
            // 导航菜单
            document.querySelector('#nav-home').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-HOME.html';
            });
            
            document.querySelector('#nav-batch').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-BATCH_PROCESS.html';
            });
            
            document.querySelector('#nav-help').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-HELP.html';
            });
        }

        // 渲染表格
        function renderTable() {
            const tbody = document.querySelector('#history-tbody');
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageData = filteredData.slice(startIndex, endIndex);
            
            tbody.innerHTML = '';
            
            pageData.forEach(record => {
                const row = document.createElement('tr');
                row.className = 'table-row-hover';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" value="${record.id}" class="rounded border-gray-300 text-primary focus:ring-primary row-checkbox">
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-900 max-w-xs truncate cursor-pointer hover:text-primary" title="${record.url}">
                            <a href="${record.url}" target="_blank" rel="noopener noreferrer">
                                ${record.url}
                            </a>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 text-xs font-medium rounded-full platform-${record.platform}">
                            ${record.platformName}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${record.time}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 text-xs font-medium rounded-full status-${record.status}">
                            ${record.status === 'success' ? '提取成功' : '提取失败'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                        <button class="text-primary hover:text-secondary transition-colors view-btn" data-id="${record.id}">
                            <i class="fas fa-eye mr-1"></i>查看
                        </button>
                        <button class="text-danger hover:text-red-600 transition-colors delete-btn" data-id="${record.id}">
                            <i class="fas fa-trash mr-1"></i>删除
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
                
                // 行复选框事件
                const rowCheckbox = row.querySelector('.row-checkbox');
                rowCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        selectedRecords.add(this.value);
                    } else {
                        selectedRecords.delete(this.value);
                    }
                    updateSelectedCount();
                    updateBatchDeleteButton();
                    updateHeaderCheckboxes();
                });
                
                // 查看按钮事件
                const viewBtn = row.querySelector('.view-btn');
                viewBtn.addEventListener('click', function() {
                    const recordId = this.dataset.id;
                    window.location.href = `P-EXTRACT_RESULT.html?recordId=${recordId}`;
                });
                
                // 删除按钮事件
                const deleteBtn = row.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', function() {
                    const recordId = this.dataset.id;
                    showDeleteModal('single', recordId);
                });
            });
        }

        // 更新分页
        function updatePagination() {
            const totalRecords = filteredData.length;
            const totalPages = Math.ceil(totalRecords / pageSize);
            const startRecord = (currentPage - 1) * pageSize + 1;
            const endRecord = Math.min(currentPage * pageSize, totalRecords);
            
            // 更新显示信息
            document.querySelector('#total-count').textContent = totalRecords;
            document.querySelector('#start-record').textContent = startRecord;
            document.querySelector('#end-record').textContent = endRecord;
            document.querySelector('#total-records').textContent = totalRecords;
            
            // 更新上一页下一页按钮状态
            const prevPageBtn = document.querySelector('#prev-page');
            const nextPageBtn = document.querySelector('#next-page');
            
            prevPageBtn.classList.toggle('pagination-disabled', currentPage <= 1);
            nextPageBtn.classList.toggle('pagination-disabled', currentPage >= totalPages);
            
            // 生成页码按钮
            generatePageNumbers(totalPages);
        }

        // 生成页码按钮
        function generatePageNumbers(totalPages) {
            const pageNumbersContainer = document.querySelector('#page-numbers');
            pageNumbersContainer.innerHTML = '';
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `px-3 py-1 border border-gray-300 rounded text-sm transition-colors ${
                    i === currentPage ? 'pagination-active' : 'hover:bg-gray-100'
                }`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => changePage(i));
                pageNumbersContainer.appendChild(pageBtn);
            }
        }

        // 改变页码
        function changePage(page) {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderTable();
                updatePagination();
            }
        }

        // 处理搜索
        function handleSearch() {
            const searchTerm = document.querySelector('#history-search').value.toLowerCase();
            applyFilters();
        }

        // 处理筛选
        function handleFilter() {
            applyFilters();
        }

        // 应用所有筛选条件
        function applyFilters() {
            const searchTerm = document.querySelector('#history-search').value.toLowerCase();
            const platformFilter = document.querySelector('#platform-filter').value;
            const statusFilter = document.querySelector('#status-filter').value;
            const timeFilter = document.querySelector('#time-filter').value;
            
            filteredData = mockHistoryData.filter(record => {
                // 搜索筛选
                const matchesSearch = !searchTerm || 
                    record.url.toLowerCase().includes(searchTerm) ||
                    record.platformName.toLowerCase().includes(searchTerm);
                
                // 平台筛选
                const matchesPlatform = !platformFilter || record.platform === platformFilter;
                
                // 状态筛选
                const matchesStatus = !statusFilter || record.status === statusFilter;
                
                // 时间筛选
                const matchesTime = !timeFilter || checkTimeFilter(record.time, timeFilter);
                
                return matchesSearch && matchesPlatform && matchesStatus && matchesTime;
            });
            
            // 应用排序
            applySorting();
            
            currentPage = 1;
            renderTable();
            updatePagination();
            updateSelectedCount();
            updateBatchDeleteButton();
        }

        // 时间筛选检查
        function checkTimeFilter(recordTime, filter) {
            const recordDate = new Date(recordTime);
            const now = new Date();
            
            switch (filter) {
                case 'today':
                    return recordDate.toDateString() === now.toDateString();
                case 'week':
                    const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return recordDate >= oneWeekAgo;
                case 'month':
                    const oneMonthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    return recordDate >= oneMonthAgo;
                default:
                    return true;
            }
        }

        // 处理排序
        function handleSort(e) {
            const field = e.currentTarget.dataset.sort;
            
            if (sortField === field) {
                sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
            } else {
                sortField = field;
                sortOrder = 'desc';
            }
            
            // 更新排序图标
            document.querySelectorAll('[data-sort] i').forEach(icon => {
                icon.className = 'fas fa-sort ml-1';
            });
            
            const currentIcon = e.currentTarget.querySelector('i');
            currentIcon.className = `fas fa-sort-${sortOrder === 'asc' ? 'up' : 'down'} ml-1`;
            
            applySorting();
            renderTable();
        }

        // 应用排序
        function applySorting() {
            filteredData.sort((a, b) => {
                let aValue, bValue;
                
                switch (sortField) {
                    case 'url':
                        aValue = a.url.toLowerCase();
                        bValue = b.url.toLowerCase();
                        break;
                    case 'platform':
                        aValue = a.platformName;
                        bValue = b.platformName;
                        break;
                    case 'time':
                        aValue = new Date(a.time);
                        bValue = new Date(b.time);
                        break;
                    case 'status':
                        aValue = a.status;
                        bValue = b.status;
                        break;
                    default:
                        return 0;
                }
                
                if (aValue < bValue) return sortOrder === 'asc' ? -1 : 1;
                if (aValue > bValue) return sortOrder === 'asc' ? 1 : -1;
                return 0;
            });
        }

        // 处理页面大小变更
        function handlePageSizeChange() {
            pageSize = parseInt(document.querySelector('#page-size').value);
            currentPage = 1;
            renderTable();
            updatePagination();
        }

        // 更新选中数量
        function updateSelectedCount() {
            document.querySelector('#selected-count').textContent = selectedRecords.size;
        }

        // 更新批量删除按钮状态
        function updateBatchDeleteButton() {
            const batchDeleteBtn = document.querySelector('#batch-delete-btn');
            batchDeleteBtn.disabled = selectedRecords.size === 0;
        }

        // 更新表头复选框状态
        function updateHeaderCheckboxes() {
            const rowCheckboxes = document.querySelectorAll('tbody input[type="checkbox"]');
            const checkedCount = Array.from(rowCheckboxes).filter(cb => cb.checked).length;
            const allChecked = checkedCount === rowCheckboxes.length && rowCheckboxes.length > 0;
            const someChecked = checkedCount > 0 && checkedCount < rowCheckboxes.length;
            
            const selectAllCheckbox = document.querySelector('#select-all');
            const headerCheckbox = document.querySelector('#header-checkbox');
            
            [selectAllCheckbox, headerCheckbox].forEach(checkbox => {
                checkbox.checked = allChecked;
                checkbox.indeterminate = someChecked;
            });
        }

        // 显示删除模态框
        function showDeleteModal(type, recordId = null) {
            const modal = document.querySelector('#delete-modal');
            const message = document.querySelector('#delete-message');
            
            modal.dataset.deleteType = type;
            modal.dataset.recordId = recordId;
            
            switch (type) {
                case 'single':
                    message.textContent = '您确定要删除这条记录吗？';
                    break;
                case 'batch':
                    message.textContent = `您确定要删除选中的 ${selectedRecords.size} 条记录吗？`;
                    break;
                case 'all':
                    message.textContent = '您确定要清空所有历史记录吗？';
                    break;
            }
            
            modal.classList.remove('hidden');
        }

        // 隐藏删除模态框
        function hideDeleteModal() {
            const modal = document.querySelector('#delete-modal');
            modal.classList.add('hidden');
        }

        // 处理确认删除
        function handleConfirmDelete() {
            const modal = document.querySelector('#delete-modal');
            const type = modal.dataset.deleteType;
            const recordId = modal.dataset.recordId;
            
            switch (type) {
                case 'single':
                    deleteRecord(recordId);
                    break;
                case 'batch':
                    deleteBatchRecords();
                    break;
                case 'all':
                    deleteAllRecords();
                    break;
            }
            
            hideDeleteModal();
        }

        // 删除单条记录
        function deleteRecord(recordId) {
            const index = mockHistoryData.findIndex(record => record.id === recordId);
            if (index !== -1) {
                mockHistoryData.splice(index, 1);
                selectedRecords.delete(recordId);
                applyFilters();
            }
        }

        // 批量删除记录
        function deleteBatchRecords() {
            selectedRecords.forEach(recordId => {
                const index = mockHistoryData.findIndex(record => record.id === recordId);
                if (index !== -1) {
                    mockHistoryData.splice(index, 1);
                }
            });
            selectedRecords.clear();
            applyFilters();
        }

        // 清空所有记录
        function deleteAllRecords() {
            mockHistoryData.length = 0;
            selectedRecords.clear();
            applyFilters();
        }

        // 防抖函数
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // 响应式处理
        function handleResize() {
            if (window.innerWidth < 768) {
                const sidebar = document.querySelector('#sidebar');
                const mainContent = document.querySelector('#main-content');
                
                sidebar.style.transform = 'translateX(-100%)';
                mainContent.classList.remove('main-content-expanded', 'main-content-collapsed');
                mainContent.style.marginLeft = '0';
            } else {
                const sidebar = document.querySelector('#sidebar');
                const mainContent = document.querySelector('#main-content');
                
                sidebar.style.transform = 'translateX(0)';
                if (sidebar.classList.contains('sidebar-collapsed')) {
                    mainContent.classList.add('main-content-collapsed');
                } else {
                    mainContent.classList.add('main-content-expanded');
                }
            }
        }

        window.addEventListener('resize', handleResize);
        handleResize(); // 初始化
    </script>
</body>
</html>